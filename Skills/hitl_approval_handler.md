# HITL Approval Handler - Silver Tier Skill

## Overview
Human-In-The-Loop (HITL) approval handler for sensitive actions including emails, posts, and payments. Manages approval workflow across all Silver Tier skills.

## Process Flow

```
1. Monitor /Pending_Approval for action requests
2. Parse action type (email, post, payment, task)
3. Present approval request to human reviewer
4. On APPROVE: Execute action via MCP/skill and move to /Approved/
5. On REJECT: Move to /Rejected/ with reason
6. Log all actions to /Logs/hitl_[date].md
```

## Monitored Actions

| Type | Source Skill | Execution |
|------|--------------|-----------|
| `email_draft` | Email MCP | Send via Gmail API |
| `linkedin_draft` | Auto LinkedIn Poster | Publish to LinkedIn |
| `payment_request` | Task Analyzer | Process payment |
| `business_lead` | Ralph Loop | Trigger follow-up |
| `urgent_task` | Any Skill | Immediate execution |

## Usage

### Command Line
```bash
python Skills/hitl_approval_handler.py
```

### With PM2 (Continuous Monitoring)
```bash
pm2 start Skills/hitl_approval_handler.py --name "hitl-handler" --interpreter python
```

### Example Trigger
```
@HITL Approval Handler check Pending_Approval
```

## Dependencies

```bash
pip install pyyaml
```

## Configuration

- **Scan Interval:** 30 seconds
- **Pending Approval Dir:** `/Pending_Approval/`
- **Approved Dir:** `/Approved/`
- **Rejected Dir:** `/Rejected/`
- **Log Dir:** `/Logs/`

## Action Request Format

Files in `/Pending_Approval/` should follow this format:

```markdown
---
type: email_draft
action_id: email_2026-02-20_14-30-00
source: email_draft_2026-02-20T14-30-00.md
created: 2026-02-20T14:30:00
status: pending_approval
priority: normal
---

# Approval Request: Send Email

## Action Details
- **Type:** Email Draft
- **To:** client@example.com
- **Subject:** Project Proposal
- **Body:** [Email content...]

## Approval Required

- [ ] **APPROVE** - Execute action (send email)
- [ ] **REJECT** - Cancel action
- [ ] **EDIT** - Modify and resubmit

## Approval Decision

<!-- Human reviewer fills this section -->
Decision: [APPROVED|REJECTED]
Reason: [Optional reason]
Reviewed by: [Name]
Reviewed at: [Timestamp]

---
*Generated by HITL Approval Handler - Silver Tier*
```

## Log Format

Logs saved to `/Logs/hitl_YYYY-MM-DD.md`:

```markdown
# HITL Approval Log - 2026-02-20

## Actions Processed

| Time | Action ID | Type | Decision | Executed By |
|------|-----------|------|----------|-------------|
| 14:35:00 | email_001 | email_draft | APPROVED | Email MCP |
| 15:20:00 | post_001 | linkedin_draft | REJECTED | - |

## Details

### [14:35:00] email_001 - APPROVED
- **Type:** email_draft
- **Source:** email_draft_2026-02-20T14-30-00.md
- **Executed:** Email sent to client@example.com
- **Log:** /Logs/email_mcp.log

### [15:20:00] post_001 - REJECTED
- **Type:** linkedin_draft
- **Source:** linkedin_post_2026-02-20_15-00-00.md
- **Reason:** Content needs revision
- **Reviewer:** Manager
```

## Integration Points

### Email MCP
```python
# After approval, call Email MCP send_email tool
result = send_email_via_mcp(draft_content)
```

### Auto LinkedIn Poster
```python
# After approval, publish to LinkedIn
result = publish_linkedin_post(draft_content)
```

### Payment Processing
```python
# After approval, process payment (flag >$500 per Company Handbook)
result = process_payment(payment_details)
```

## Test Instructions

1. **Create test approval request in `/Pending_Approval/`:**
```bash
# Create test email draft approval
echo "---
type: email_draft
action_id: test_email_001
source: test_draft.md
created: 2026-02-20T14:30:00
status: pending_approval
---

# Approval Request: Send Test Email

## Action Details
- **To:** test@example.com
- **Subject:** Test Email
- **Body:** This is a test.

## Approval Required
- [ ] APPROVE
- [ ] REJECT
" > Pending_Approval/test_email_001.md
```

2. **Run the skill:**
```bash
python Skills/hitl_approval_handler.py
```

3. **Check results:**
   - `/Approved/` - Approved actions
   - `/Rejected/` - Rejected actions
   - `/Logs/hitl_[date].md` - Activity log

## Rules (from Company Handbook)

1. **Always be polite** - All communications reviewed for professionalism
2. **Flag payments > $500** - High-value payments require additional approval
3. **Audit trail** - All actions logged with timestamps
